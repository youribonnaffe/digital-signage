<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta charset="utf-8">
    <style>
        * {
            font-family: Arial, sans-serif;
        }

        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
        }

        iframe {
            border: none;
            width: 100%;
            height: 100%;
        }

        /*https://coolors.co/0a2463-fb3640-605f5e-247ba0-e2e2e2*/
        #debug {
            visibility: hidden;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99;
            background-color: rgba(36, 123, 160, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #url {
            padding: 20px;
            background-color: rgb(226, 226, 226);
            border-radius: 10px;

        }
    </style>
</head>
<body>
<iframe id="display" width="100%" height="100%">
</iframe>
<div id="debug">
    <p id="url">Nothing set yet</p>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
  const DEBUG_KEY = 'd';

  function random() {
    return Math.random().toString(36).substring(7);
  }

  function displayUrl(msg) {
    document.getElementById('display').src = msg.url;
    document.getElementById('url').innerHTML = msg.url;
  }

  document.addEventListener('DOMContentLoaded', function () {
    var socket = io();

    const url = new URL(window.location.href);
    const name = url.searchParams.get('name') || prompt('Client name?', random());
    const network = url.searchParams.get('network') || prompt('Network name?', random());

    console.log(`Joining ${network} with name ${name}`);
    socket.emit('join', {network: network, name: name}, (data) => {
      displayUrl(data);
    });
    document.title = `${network} - ${name}`;

    socket.on('reconnect', function (msg) {
      socket.emit('join', {network: network, name: name}, (data) => {
        displayUrl(data);
      });
    });

    socket.on('url', function (msg) {
      console.log(`Received ${msg}`);
      displayUrl(msg);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === DEBUG_KEY) {
        document.getElementById('debug').style.visibility = 'visible';
      }
    });

    document.addEventListener('keyup', (e) => {
      if (e.key === DEBUG_KEY) {
        document.getElementById('debug').style.visibility = 'hidden';
      }
    });
  });
</script>
</body>
</html>